<!DOCTYPE html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="keywords" content="jquery,ui,easy,easyui,web">
<meta name="description" content="easyui help you build your web page easily!">

<title>运营管理工具导航页</title>
<link rel="stylesheet" type="text/css" href="http://www.w3cschool.cc/try/jeasyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="http://www.w3cschool.cc/try/jeasyui/themes/icon.css">
<link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">  
<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.w3cschool.cc/try/jeasyui/jquery.easyui.min.js"></script>

</head>

<body>
  
<div id="tt" class="easyui-tabs" style="width:auto;height:500px;">
    <div title="游戏账号查询" style="padding:20px;">
				
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <div class="form-group" style="padding: 10px 10px 0px;">
              <select id="serverbox0" class="form-control">
              </select>										
            </div>	
          </ul>	 	
            <form class="navbar-form navbar-left" role="search" >
              <div class="form-group">
                <input type="text" class="form-control" id="accountName" placeholder="请输入玩家账号"/>
              </div> 
              <button type="button" class="btn btn-default" id="FindByNameBtn" onclick="FindByName()" >查找</button>
            </form> 
				</div>
				
			<div class="row clearfix">
		<div class="col-md-12 column">
			<table class="table" id="myTable">
				  <thead>
            <tr>
              <th>账号</th>
              <th>密码</th>
              <th>名字</th>
              <th>UUID</th>
              <th>等级</th>	
              <th>金币</th>		
              <th>钻石</th>
              <th>星尘</th>
              <th>状态</th>
            </tr>
				  </thead>
				  <tbody>
					<tr width="100" border="0" cellspacing="0" cellpadding="0" style="cursor:pointer;" >
						<td>account</td>
						<td>password</td>
						<td>又见一只奶酪君</td>
						<td>5553546</td>
						<td>30</td>
						<td>535461</td>
						<td>462161561</td>
						<td>100506</td>
						<td>不在线</td>
					</tr>
					
				  </tbody>
			  </table>
		  </div>
	  </div>
  </div>

    <div title="游戏角色名称查询" data-options="closable:true" style="overflow:auto;padding:20px;">
      	<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <div class="form-group" style="padding: 10px 10px 0px;">
              <select id="serverbox1" class="form-control">
              </select>										
            </div>	
          </ul>	 	
            <form class="navbar-form navbar-left" role="search" >
              <div class="form-group">
                <input type="text" class="form-control" id="PlayerName" placeholder="请输入玩家名字"/>
              </div> 
              <button type="button" class="btn btn-default" id="FindByNameBtn" onclick="FindByPlayer()" >查找</button>
            </form> 
				</div>
				
			<div class="row clearfix">
		<div class="col-md-12 column">
			<table class="table" id="myTablePlayer">
				<thead>
					<tr>
					  <th>名字</th>
						<th>UUID</th>
						<th>等级</th>		
            <th>金币</th>	
						<th>钻石</th>
						<th>星尘</th>
						<th>状态</th>
					</tr>
				</thead>
				<tbody>
					<tr width="100" border="0" cellspacing="0" cellpadding="0" style="cursor:pointer;" >
						<td>又见一只奶酪君</td>
						<td>5553546</td>
						<td>30</td>
						<td>535461</td>
						<td>462161561</td>
						<td>100506</td>
						<td>不在线</td>
					</tr>
					
				</tbody>
			</table>
		</div>
	</div>
	
    </div>

    <div title="修改属性值" data-options="iconCls:'icon-reload',closable:true" style="padding:20px;">
       <ul class="nav navbar-nav">
            <div class="form-group" style="padding: 10px 10px 0px; display:inline;">
                <select id="serverbox2" class="form-control" style="display:inlinek;">
                </select>	
                <input type = "text" class="form-control" id = "Actorid" placeholder="角色ID"  style="display:inline;" />
                <select id="PropBox" class="form-control"  style="display:inline;" >
                <option value="21">设置金币</option>
                <option value="36">设置经验</option>
                <option value="22">设置钻石</option>
                </select>
                <input type = "text" class="form-control" id = "param1" placeholder="修改值"  style="display:inline;" />
                <button type="button" class="btn btn-default" id="ModifyBtn" onclick="UpdatePlayer()" >修改</button>							
            </div>	
          </ul>	 
    </div>

    <div title="踢人封号" data-options="iconCls:'icon-reload',closable:true" style="padding:20px;">
       <ul class="nav navbar-nav">
          <div class="form-group" style="padding: 10px 10px 0px; display:inline;">
                <select id="serverbox3" class="form-control" style="display:inlinek;">
                </select>	
                <input type = "text" class="form-control" id = "KickActorid" placeholder="角色ID"  style="display:inline;" />
                <input type = "text" class="form-control" id = "Kickparam1" placeholder="封号时长"  style="display:inline;" />
                <button type="button" class="btn btn-default" id="BannedBtn" onclick="BannedPlayer()" >封号</button>
                <button type="button" class="btn btn-default" id="KickBtn" onclick="KickPlayer()" >踢人</button>							
          </div>	
      </ul>	 
    </div>

    <div title="发送邮件" data-options="iconCls:'icon-reload',closable:true" style="padding:20px;">
       <ul class="nav navbar-nav">
          <div class="form-group" style="padding: 10px 10px 0px; display:inline;">
              <select id="serverbox4" class="form-control" >
              </select>	
              <!-- input type = "text" class="form-control" id = "MailResID" placeholder="邮件资源ID"  / -->
              <input type = "text" class="form-control" id = "MailTitle" placeholder="邮件标题少于16个汉字"  />
              <input type = "text" class="form-control" id = "MailFrom" placeholder="邮件发送者"  />
              <input type = "text" class="form-control" id = "MailTo" placeholder="邮件接收者"  />
              <input type = "text" class="form-control" id = "MailContent" placeholder="邮件内容"  />
              <textarea rows="5" cols="150">
              邮件附件格式: [{"22_1":500},{"406_7":1}] ,其中 "22_1":500 表示人物属性钻石数量500,22代表钻石，1表示人物属性 ， "406_7":1表示金币包一个，406金币包道具，7表示物品
              </textarea>
              <input type = "text" class="form-control" id = "MailAttachments" placeholder="邮件附件"  />
              <input type = "text" class="form-control" id = "MailEndTime" placeholder="邮件过期时间（单位小时）" onkeyup="value=value.replace(/[^\d]/g,'') " ng-pattern="/[^a-zA-Z]/" />
             
  
              <button type="button" class="btn btn-default"  onclick="SendMail()" >发送邮件</button>							
          </div>	
      </ul>	 
    </div>

    <div title="数据统计" data-options="iconCls:'icon-reload',closable:true" style="padding:20px;">
       <ul class="nav navbar-nav">
          <div class="form-group" style="padding: 10px 10px 0px; display:inline;">
              <select id="serverbox5" class="form-control" >
              </select>	
              <div>
                <input type = "text" class="form-control" readonly id = "online" value="服务器当前在线人数："  />
                <button type="button" class="btn btn-default"  onclick="GetOnline()" >查询</button>		
              </div>					
          </div>	
      </ul>	 
    </div>

     <div title="背包查询" data-options="iconCls:'icon-reload',closable:true" style="padding:20px;">
       <ul class="nav navbar-nav">
          <div class="form-group" style="padding: 10px 10px 0px; display:inline;">
              <select id="serverbox6" class="form-control" >
              </select>	
              <div>
                <input type = "text" class="form-control"  id = "GetBagActorID" placeholder="查询背包角色ID"  />
                <button type="button" class="btn btn-default"  onclick="GetBag()" >查询</button>
                <br></br>
                <textarea  rows="5" cols="150">
                    1_4:"资源ID"  2_4:"物品类型"  3_4:"物品名字" 5_4:"物品数量" 6_4:"物品品质" 10_4:"物品serverid"
                </textarea>	
                <br></br>	
                <textarea  id = "GetBagRsp" rows="5" cols="150">
                    背包内容: 
                </textarea>		
              </div>					
          </div>	
      </ul>	 
    </div>

</div>
	<script src="http://192.168.31.249:8081/socket.io/socket.io.js"> </script>
  <script type="text/javascript" >
    var socket = io.connect('http://192.168.31.249:8081');
    function $my(id){return document.getElementById(id); }
    function isJSON(str) {
            if (typeof str == 'string') {
                try {
                    var obj=JSON.parse(str);
                    if(typeof obj == 'object' && obj ){
                        return true;
                    }else{
                        return false;
                    }

                } catch(e) {
                    console.log('error：'+str+'!!!'+e);
                    return false;
                }
            }
            return false;
    }
    $(document).ready(function(){
       //document.getElementById("serverbox3").options.add(new Option("abc","123"));
       var severlist=[ {"name":"内网服","value":"192.168.31.118","area":"2","port":"8080" },
                       {"name":"外网服","value":"120.76.235.228","area":"5012","port":"8080" },
                       {"name":"李涵锋","value":"192.168.31.249","area":"5013","port":"8080" },
                       {"name":"策划测试服","value":"192.168.31.156","area":"8","port":"8085" }, ];
       var UIlist = [ "serverbox0","serverbox1","serverbox2","serverbox3","serverbox4","serverbox5","serverbox6"];
       for(var i=0; i<UIlist.length; i++)
       {
         ShowServerList(UIlist[i],severlist);
       }
       
    })
    function ShowServerList(UI,severlist)
    {
        for(var i=0; i<severlist.length; i++)
       {
            var op=document.createElement("option");      // 新建OPTION (op) 
            op.setAttribute("value",severlist[i]["value"]);                   // 设置OPTION的 VALUE 
            op.setAttribute("area",severlist[i]["area"]); 
            op.setAttribute("port",severlist[i]["port"]); 
            op.appendChild(document.createTextNode(severlist[i]["name"])); // 设置OPTION的 TEXT
            for(var j=0; j<4; j++)
            {
                document.getElementById(UI).appendChild(op);           // 为SELECT 新建一 OPTION(op)
            }
            
       }
    }
    function GetBag()
    {
        var serverboxid = "serverbox6"
        var x=document.getElementById(serverboxid).selectedIndex;
	    var host = $my(serverboxid).value;
        var port = $my(serverboxid)[x].getAttribute("port");
        
        var param = {};
        param.uid = document.getElementById("GetBagActorID").value;

        socket.emit('GetBag', host,port,param);
    }
    socket.on('GetBagRsp',function(content){
        $my('GetBagRsp').value =JSON.stringify(content);
    })
    function GetOnline()
    {
        var serverboxid = "serverbox5"
        var x=document.getElementById(serverboxid).selectedIndex;
	    var host = $my(serverboxid).value;
        var port = $my(serverboxid)[x].getAttribute("port");
        
        socket.emit('online', host,port);
    }
    socket.on('onlineRsp',function(content){
        $my('online').value = content["count"];
    })
    function SendMail()
    {
      
        var x=document.getElementById("serverbox4").selectedIndex;
	    var host = $my("serverbox4").value;
        var port = $my("serverbox4")[x].getAttribute("port");
        
        var param = {};
        param.id = "1";//document.getElementById("MailResID").value;
        param.title = document.getElementById("MailTitle").value;
        param.from = document.getElementById("MailFrom").value;
        param.to = document.getElementById("MailTo").value;
        param.account = "";
        param.channel = "";
          
        param.content = document.getElementById("MailContent").value;
        param.showStart = new Date().getTime();
        param.showEnd= new Date().getTime()+$my('MailEndTime').value*60*60*1000;
        var arg = document.getElementById("MailAttachments").value;
        if(arg.length == 0)
        {
           param.attachments =  {};
        }
        else
        {
             if(!isJSON(arg))
            {
                alert("邮件参数错误");
                 return;
             }
            param.attachments= JSON.parse(arg);
        }
        alert("sendMail")
        socket.emit('sendMail', host,port,param);
    }
    socket.on('sendMailRsp',function(content){
      alert(content);
    })
    function BannedPlayer()
    {
      	var x=document.getElementById("serverbox3").selectedIndex;
	    var host = $my("serverbox3").value;
        var port = $my("serverbox3")[x].getAttribute("port");
        var ActoridText = document.getElementById("KickActorid");
        var param = {};
        param.uid = ActoridText.value;
        param.time = document.getElementById("Kickparam1").value;
        param.mode = "";
        socket.emit('BannedPlayer', host,port,param);
    }
    function KickPlayer()
    {
       	var x=document.getElementById("serverbox3").selectedIndex;
        alert(document.getElementById("serverbox3"));
	    var host = $my("serverbox3").value;
        var port = $my("serverbox3")[x].getAttribute("port");
        var ActoridText = document.getElementById("KickActorid");
        var updataparam = {};
        updataparam.uid = ActoridText.value;
        socket.emit('KickPlayer', host,port,updataparam);
    }
    function UpdatePlayer(mousedown)
    {
        var ActoridText = document.getElementById("Actorid");
        var boxtext = document.getElementById("PropBox");
        var param1text = document.getElementById("param1");
        var updataparam = {};
        updataparam.uid = ActoridText.value;
        updataparam.param = [{}];
        updataparam.param[0] [boxtext.value+"_"] =param1text.value;
       
       	var x=document.getElementById("serverbox2").selectedIndex;
        var host = $my("serverbox2").value
        var port = $my("serverbox2")[x].getAttribute("port");

        socket.emit('updatePlayer', host,port,updataparam);
        return false;
    }
    function AddMessage(message)
    {
		    $("#myTable tr:not(:first)").empty(""); 
		    var table=document.getElementById("myTable");
		    for(var i=0; i<message.data.length; i++)
        {
            var row=table.insertRow(1);
            var col =0;
            var cellaccount=row.insertCell(col++);
            var cellpassword=row.insertCell(col++);
            var cellname=row.insertCell(col++);
            var celluuid=row.insertCell(col++);
            var celllevel = row.insertCell(col++);
            var cellgold = row.insertCell(col++);
            var celldiamond = row.insertCell(col++);
            var cellstar = row.insertCell(col++);
            var cellonline = row.insertCell(col++);

            cellaccount.innerHTML=message.data[i]["996_1"];
            cellpassword.innerHTML=message.data[i]["0_1"];
            cellname.innerHTML=message.data[i]["3_1"];
            celluuid.innerHTML=message.data[i]["2_1"];
            celllevel.innerHTML=message.data[i]["6_1"];
            cellgold.innerHTML=message.data[i]["21_1"];
            celldiamond.innerHTML=message.data[i]["22_1"];
            cellstar.innerHTML=message.data[i]["26_1"];
            cellonline.innerHTML=message.data[i]["999_1"];
        }
    }
  
    socket.on('searchAccountRsp',function(content)
    {
        AddMessage(content );
    });
     socket.on('searchPlayerRsp',function(content)
    {
        AddPlayerMessage(content );
    });
    socket.on('BannedPlayerRsp',function(content){
      alert(content);
    })
    function FindByName (mousedown)
    {
	    	var x=document.getElementById("serverbox0").selectedIndex;
		    var host = $my("serverbox0").value;
        var port = $my("serverbox0")[x].getAttribute("port");
        socket.emit('searchAccount', host,port,{ user: $my('accountName').value ,area:$my("serverbox0")[x].getAttribute("area") });
        return false;
    }

    function AddPlayerMessage(message)
    {
        $("#myTablePlayer tr:not(:first)").empty(""); 
        var table=document.getElementById("myTablePlayer");
        for(var i=0; i<message.data.length; i++)
        {
            var row=table.insertRow(1);
            var col =0;
            var cellname=row.insertCell(col++);
            var celluuid=row.insertCell(col++);
            var celllevel = row.insertCell(col++);
            var cellgold = row.insertCell(col++);
            var celldiamond = row.insertCell(col++);
            var cellstar = row.insertCell(col++);
            var cellonline = row.insertCell(col++);

            cellname.innerHTML=message.data[i]["3_1"];
            celluuid.innerHTML=message.data[i]["2_1"];
            celllevel.innerHTML=message.data[i]["6_1"];
            cellgold.innerHTML=message.data[i]["21_1"];
            celldiamond.innerHTML=message.data[i]["22_1"];
            cellstar.innerHTML=message.data[i]["26_1"];
            cellonline.innerHTML=message.data[i]["999_1"];
        }
    }
   
    function FindByPlayer (mousedown)
    {
		  	var x=document.getElementById("serverbox1").selectedIndex;
	    	var host = $my("serverbox1").value;
        var port = $my("serverbox1")[x].getAttribute("port");
        socket.emit('searchPlayer', host,port,{ user: $my('PlayerName').value ,area:$my("serverbox1")[x].getAttribute("area") });
        return false;
    }
    </script>
</body>
